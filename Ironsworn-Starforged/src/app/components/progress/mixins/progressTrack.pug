include ./progressButtons
include ../../clock/clock


mixin sceneChallenge()
  +progressTrack(["scene-challenge"])
    input(
      type="text"
      name="attr_name"
      placeholder="Scene challenge objective"
    )
    input(
      type="hidden"
      name="attr_rank"
      value="3"
    )
    //- scene challenges are always formidable
    +clock("scenechallenge", false, false)

mixin progressTrack(classes=[], attrPrefix="progress", progressMoveId)
  article(class=["progress-track", ...classes])
    +progressTotal(attrPrefix)
    block
    +progressClearBtn(attrPrefix)
    +progressTrackBar(attrPrefix)
    +progressRepeatingRollBtn(progressMoveId)

mixin progressTotal(attrPrefix="progress")
  //- hidden counter for total progress
  - let progressSum = track.map(boxIndex => `@{${attrPrefix}_${boxIndex}}`).join("+")
  input(
    type='hidden'
    name=`attr_${attrPrefix}-filled`
    value=`0`
    )

mixin progressTrackBar(attrPrefix="progress")
  button(
    type="action"
    name="act_progress-mark"
    class=["progress-track-bar"]
    data-i18n-title="progress-mark"
    )
    each value in track
      +progressBox(value, attrPrefix)

mixin progressBox(index, attrPrefix="progress", block=false)
  - let attribute_name = `attr_${attrPrefix}_${index}`
  input(type="hidden" name=attribute_name class=["progress-box-control"] value=0)
  div(class=["progress-box"])
    if block == true
      block

//- mixin progressTrackBar_old(attrPrefix="progress")
//-   section.progress-track-bar
//-     each value in track
//-       +progressBox_old(value, attrPrefix)

//- mixin progressBox_old(index, attrPrefix="progress"=false)
//-   - let attribute_name = `attr_${attrPrefix}_${index}`
//-   section.progress-box
//-     input(type="hidden" name=attribute_name class=["progress-box-control"] value=0)
//-     +progressBoxSelect(index, attrPrefix)
//-     if (xpBoxAttr)
//-       +legacyXpBoxes(xpBoxAttr, index)

//- mixin progressBoxSelect(index, attrPrefix="progress")
//-   - let attribute_name = `attr_${attrPrefix}_${index}`
//-   select(name=attribute_name class=["progress-box"])
//-     option(value="0")
//-     option(value="1") -
//-     option(value="2") +
//-     option(value="3") *
//-     option(value="4") #

include ../../../common/pug/button

mixin oracleListGroupItem(id, buttonLabel)
  +oracleRollBtn(id, buttonLabel)
  +toggleBtn(buttonLabel.replace(/ - /i, ": "), "selected_oracle", id)

mixin oracleSubtablesListGroupItem(id, buttonLabel, tables)
  +oracleSubtablesRollBtn(id, buttonLabel, tables)
  +toggleBtn(buttonLabel.replace(/ - /i, ": "), "selected_oracle", id)

mixin oracleSubtablesRollBtn(id, buttonLabel, tables)
  -
    let counter = 0;Label
    let options = [];
    tables.forEach((oracle) => {
      if (oracle.Tables) {
        oracle.Tables.forEach(subtable => {
          let tableLabel = subtable['Display name']||subtable['Name'];
          options.push(`${tableLabel},${counter}`);
          counter++;
        })
      }
      else {
        let tableLabel = oracle['Display name']||oracle['Name'];
        options.push(`${tableLabel},${counter}`);
        counter++;
      }
    })
  - const rollQuery = `{{tableChoice=[[(?{Choose Table|${options.join('|')}})]]}}`
  +oracleRollBtn(id, buttonLabel, rollQuery)

mixin oracleRollBtn(id, buttonLabel, rollQuery="")
  //- generates CSS
  //- - console.log(`input[type=radio].${id}:checked ~ div.${id},`)
  -
    let valueString = `&{template:starforged_oracles} ${rollQuery} {{${id}=[[d100]]}}`;
    if (!rollQuery.match(/header=/i)) {
      valueString = valueString + " " +  `{{header=${buttonLabel}}}`
    }
  button(
    type='roll'
    class='roll-show ui-draggable icon-only'
    title=`@{roll_${id}}`
    name=`roll_${id}`
    value=valueString
  )

mixin oracleMultiBtn(oracle, btnText, indexOffset=0)
  - const labelText = oracle['Display name']||oracle['Name']
  - const options = oracle.Tables.map((table, index) => { return `${table['Display name']||table['Name']},${index+indexOffset}` })
  - const rollQuery = `{{tableChoice=[[(?{Choose Table|${options.join('|')}})]]}} {{header=${labelText}}}`
  - const id = oracle.id
  button.roll-label.embedded-btn.button-text(
    type='roll'
    title=`@{roll_${id}}`
    name=`roll_${id}`
    value=`&{template:starforged_oracles} ${rollQuery}  {{${id}=[[d100]]}}`
  )!=btnText||labelText

mixin oracleSingleButton(oracle, btnText)
  - const labelText=oracle['Display name']||oracle.Name
  - const id = oracle.id
  button.roll-label.embedded-btn.button-text(
    type='roll'
    title=`@{roll_${id}}`
    name=`roll_${id}`
    value=`&{template:starforged_oracles} {{header=${labelText}}} {{${id}=[[d100]]}}`
  )!=btnText||labelText

include ./mixins/oracleTable
include ./mixins/oracleListGroupItem
include ../../common/pug/button
include ../image/gameIcon



mixin oracleRollGroup(group)
  +listGroup(group['Display name']||group.Name, false)
    each oracle in group.Oracles
      - header = `${group['Display name']||group.Name} - ${oracle.Name}`
      +listGroupItem()
        -
          //- console.log("Rendering:", oracle.Name)
          buttonLabel = (oracle['Display name'] ? oracle['Display name'] : oracle.Name).replace(/(Ask the Oracle|Character Name)\W*/i, "")
          // trims excessively long strings so buttons stay on one line
        if (oracle.Tables)
          +oracleSubtablesListGroupItem(oracle.id, buttonLabel, oracle.Tables)
        else
          +oracleListGroupItem(oracle.id, buttonLabel)
    if group.Subcategories
      each subCategory in group.Subcategories
        - buttonLabel = subCategory['Display name']||subCategory.Name
        +listGroupItem()
          +oracleSubtablesListGroupItem(subCategory.id, buttonLabel, subCategory.Oracles)

mixin oraclePreview(oracle, groupName)
  +rulesArticle(null, ["oracle", oracle.id])
    - nameString = oracle['Display name'] && oracle['Display name'].match(/ - /i) ? oracle['Display name'].replace(/ - /i, ": ") : `${groupName}: ${oracle['Display name']||oracle.Name}`
    h3=nameString
    if oracle.Table
      +oracleRollBtn(oracle.id, oracle['Display name']||oracle.Name)
    else if oracle.Tables
      +oracleSubtablesRollBtn(oracle.id, oracle['Display name']||oracle.Name, oracle.Tables)
    else if oracle.Oracles
      +oracleSubtablesRollBtn(oracle.id, oracle['Display name']||oracle.Name, oracle.Oracles)
    +closeButton("oracle")
    section.gamerules-body
      if oracle.Table
        +oracleTable(oracle)
      else if oracle.Tables
        +oracleMultiSubTable(oracle)
      else if oracle.Oracles
        +gameIcon(oracle.id)
        if (oracle.Description)
          section.oracle-description=oracle.Description
        each subCatOracle, index in oracle.Oracles
          if subCatOracle.Table
            +oracleSubTable(subCatOracle)
          else if subCatOracle.Tables
            +oracleMultiSubTable(subCatOracle, true)
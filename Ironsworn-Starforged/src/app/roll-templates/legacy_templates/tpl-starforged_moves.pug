include ../mixins/negations
include ../mixins/headers
include ../mixins/body
include ../mixins/actions


mixin rollTemplateActionRoll
  rolltemplate.sheet-rolltemplate-action_roll
    .sheet-roll-container
      +tplHeader("header")
      +actionRollBody
      | {{#rollLess() computed::actionDie 1}}
      .sheet-result-body.sheet-result-row Action die cancelled by negative momentum.
      | {{/rollLess() computed::actionDie 1}}
      +challengeDice
      +moveResult

mixin moveResult
  .sheet-result-body.sheet-result-row!=`result: {{computed::moveOutcome}} {{#rollTotal() challengeDie1 challengeDie2}} with a match!{{/rollTotal() challengeDie1 challengeDie2}}`

//- this is a mixin so the variables are properly scoped
mixin rollTemplateActionRollOld
  - let maxNegMomentum = 6
  rolltemplate.sheet-rolltemplate-starforged_moves
    .sheet-roll-container
      | {{#action}}
      +tplHeader("name")
      | {{#rollLess() momentum 0}}
      - let counter = 1;
      while counter <= maxNegMomentum
        +cancelRollOld(counter, 'action')
        - counter++;
      | {{/rollLess() momentum 0}}
      | {{#^rollLess() momentum 0}}
      +actionRollBodyOld('action')
      +challengeDiceOld
      +standardActionWithMomentum('action')
      | {{/^rollLess() momentum 0}}
      | {{/action}}

      | {{#custom}}
      | {{#header}}
      .sheet-result-body.sheet-result-row
        h1 {{header}}
      | {{/header}}
      .sheet-result-body.sheet-result-row
        div {{name}}
      | {{#allprops() custom name header}}
      .sheet-result-body.sheet-result-row
        div {{key}}
        div {{value}}
      | {{/allprops() custom name header}}
      | {{/custom}}

+rollTemplateActionRoll
+rollTemplateActionRollOld
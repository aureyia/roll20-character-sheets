include ./oracleRollTemplateRow

mixin oracleRollTemplate(oracle)
  - id = oracle.id;
  |
  | {{##{id}}}
  .sheet-result-row
    .sheet-oracle-dice
      span {{#{id}}}
    .sheet-oracle-table-text
      if oracle.Table
        each row, index in oracle.Table
          +oracleRollTemplateRow(id, oracle.Table, row, index)
      else if oracle.Tables
        each subtable, index in oracle.Tables
          |
          | {{#rollTotal() tableChoice #{index}}}
          each row, index in subtable.Table
            +oracleRollTemplateRow(id, subtable.Table, row, index)
            |
          | {{/rollTotal() tableChoice #{index}}}
      else if oracle.Oracles
        +oracleRollTemplateMulti(oracle)
  |
  | {{/#{id}}}

mixin oracleRollTemplateMulti(oracle)
  //- this is a mixin for modularity + variable scoping
  - let counter = 0;
  //- uses a counter instead of index to better handle any nested subtables
  each subCatOracle in oracle.Oracles
    if subCatOracle.Table
      |
      | {{#rollTotal() tableChoice #{counter}}}
      each row, index in subCatOracle.Table
        +oracleRollTemplateRow(id, subCatOracle.Table, row, index)
        |
      | {{/rollTotal() tableChoice #{counter}}}
      - counter++
    else if subCatOracle.Tables
      each subCatOracleSubTable in subCatOracle.Tables
        |
        | {{#rollTotal() tableChoice #{counter}}}
        each row, index in subCatOracleSubTable.Table
          +oracleRollTemplateRow(id, subCatOracleSubTable.Table, row, index)
          |
        | {{/rollTotal() tableChoice #{counter}}}
        - counter++
